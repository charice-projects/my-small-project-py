
## 24. README.md

# Omniframe Server

> 🤖 智能文件协同服务器 - 人类主导方向，AI实现逻辑

## 🎯 简介

Omniframe Server 是一个智能文件协同服务器，它允许您使用自然语言命令来管理本地文件系统。基于"人类主导方向，AI实现逻辑"的协作理念，它将传统的文件操作转化为智能、语义化的交互体验。

## ✨ 核心特性

### 🧠 智能意图理解
- **自然语言命令**：使用自然语言管理文件，如"查找所有PDF文档"、"打包上周修改的文件"
- **意图解析引擎**：智能解析用户意图，转化为具体的文件操作
- **上下文感知**：记住您的操作历史和工作模式

### 🛡️ 安全与规则
- **宪法规则引擎**：所有操作必须符合预设的宪法规则
- **安全沙盒**：操作限制在工作空间内，保护系统文件
- **操作确认**：高风险操作需要明确确认

### 📁 文件管理
- **智能索引**：自动创建和维护文件索引
- **高级搜索**：按名称、内容、类型、时间等多维度搜索
- **批量操作**：支持批量打包、移动、复制等操作
- **文件监控**：实时监控文件变化

### 🖥️ 多种访问方式
- **Web界面**：现代化的Web界面，支持自然语言输入
- **命令行工具**：功能强大的CLI，支持脚本化操作
- **REST API**：完整的API接口，支持第三方集成

## 🚀 快速开始

### 系统要求
- Python 3.8+
- Windows 10+ (推荐) 或 Linux/macOS
- 至少 100MB 可用空间

### 安装步骤

1. **克隆或下载项目**
   ```bash
   git clone <项目地址>
   cd omniframe_server
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **配置环境**
   ```bash
   cp .env.example .env
   # 编辑 .env 文件，设置工作空间路径等
   ```

4. **启动服务器**
   ```bash
   python server.py
   ```

5. **访问Web界面**
   打开浏览器访问：`http://localhost:8080`

### Docker 运行
```bash
docker build -t omniframe .
docker run -p 8080:8080 -v /path/to/workspace:/workspace omniframe
```

## 📖 使用指南

### Web界面使用

1. **初始化索引**
   - 在命令输入框输入"初始化索引"
   - 系统将扫描工作空间并创建智能索引

2. **基本文件操作**
   ```
   # 列出文件
   "列出所有文件"
   "显示最近修改的文件"
   
   # 搜索文件
   "查找所有图片"
   "搜索包含'报告'的文档"
   
   # 批量操作
   "打包所有PDF文件"
   "删除上个月创建的临时文件"
   ```

3. **系统管理**
   ```
   "显示系统状态"
   "查看命令历史"
   "更新索引"
   ```

### 命令行使用

```bash
# 进入交互模式
python cli.py -i

# 直接执行命令
python cli.py "初始化索引"
python cli.py list /path/to/dir -r
python cli.py search "报告" --path /docs
```

### API接口

服务器提供完整的REST API：

```bash
# 执行命令
curl -X POST http://localhost:8080/api/commands/execute \
  -H "Content-Type: application/json" \
  -d '{"command": "初始化索引"}'

# 列出文件
curl "http://localhost:8080/api/files/list?path=/docs&recursive=true"

# 系统信息
curl http://localhost:8080/system/info
```

## ⚙️ 配置说明

### 主要配置项

在 `.env` 文件中配置：

```env
# 服务器配置
OMNIFRAME_HOST=0.0.0.0
OMNIFRAME_PORT=8080
OMNIFRAME_ROOT_PATH=/path/to/workspace

# 安全配置
SECRET_KEY=your-secret-key
ENABLE_AUTH=false
SAFE_MODE=true

# 索引配置
INDEX_AUTO_UPDATE=true
INDEX_UPDATE_INTERVAL=300

# 宪法规则
CONSTITUTION_ENABLED=true
```

### 宪法规则

宪法规则定义在 `config/constitution.yaml` 中，控制系统的安全策略：

```yaml
rules:
  - id: "RULE-001"
    name: "删除保护"
    condition: "operation.type == 'delete'"
    action: "require_confirmation"
    
  - id: "RULE-002"
    name: "系统文件保护"
    condition: "operation.target_path.contains('system')"
    action: "block"
```

## 🏗️ 系统架构

```
omniframe_server/
├── server.py                    # 主服务器
├── cli.py                      # 命令行工具
├── requirements.txt            # 依赖列表
├── .env                        # 环境配置
│
├── core/                       # 核心模块
│   ├── intent_parser.py        # 意图解析
│   ├── file_indexer.py         # 智能索引
│   ├── context_manager.py      # 上下文管理
│   ├── constitution_engine.py  # 宪法引擎
│   └── task_dispatcher.py      # 任务分发
│
├── services/                   # 服务层
│   ├── file_service.py         # 文件操作
│   ├── search_service.py       # 搜索服务
│   ├── archive_service.py      # 打包服务
│   └── monitor_service.py      # 文件监控
│
├── api/                        # API路由
│   ├── commands.py             # 命令API
│   └── files.py                # 文件API
│
├── static/                     # 前端文件
│   ├── index.html              # 主页面
│   ├── css/style.css          # 样式
│   └── js/app.js              # 前端逻辑
│
├── config/                     # 配置
│   ├── settings.py             # 配置管理
│   └── constitution.yaml       # 宪法规则
│
└── data/                       # 数据存储
    ├── file_index.yaml         # 文件索引
    └── context_cache.json      # 上下文缓存
```

## 🔧 开发指南

### 添加新的意图类型

1. 在 `core/intent_parser.py` 中添加新的意图模式
2. 在 `core/task_dispatcher.py` 中注册对应的处理函数
3. 在 `services/` 中实现相应的服务逻辑

### 扩展宪法规则

1. 编辑 `config/constitution.yaml` 文件
2. 添加新的规则定义
3. 重启服务器生效

### API开发

所有API端点都遵循RESTful设计原则，返回JSON格式数据。详细API文档可在服务器启动后访问 `/docs` 查看。

## 🧪 测试

运行测试套件：

```bash
# 安装测试依赖
pip install pytest pytest-asyncio

# 运行测试
pytest tests/
```

## 📊 监控与日志

### 日志配置
日志默认输出到 `logs/omniframe.log`，可在 `.env` 中配置：

```env
LOG_LEVEL=INFO
LOG_FILE=logs/omniframe.log
```

### 系统监控
访问以下端点获取系统状态：
- `/system/info` - 系统信息
- `/api/context/status` - 上下文状态
- `/api/commands/index/status` - 索引状态

## 🔒 安全建议

1. **生产环境配置**
   - 修改默认的SECRET_KEY
   - 启用认证 (`ENABLE_AUTH=true`)
   - 配置IP白名单 (`ALLOWED_IPS`)

2. **工作空间隔离**
   - 为不同项目设置不同的工作空间
   - 定期备份重要数据

3. **宪法规则配置**
   - 根据实际需求调整宪法规则
   - 定期审查和更新规则

## 🤝 贡献指南

**Omnframe Server** - 让文件管理更智能！ 🤖✨
```

## 25. 项目根目录文件

### 项目结构总结

至此，我们已经完成了Omniframe Server的所有核心代码文件。完整的项目结构如下：

```
omniframe_server/
├── server.py                    # 主服务器文件
├── cli.py                      # 命令行工具
├── requirements.txt            # Python依赖
├── README.md                   # 项目文档
├── .env.example                # 环境变量示例
├── .gitignore                  # Git忽略配置
│
├── core/                       # 核心模块
│   ├── __init__.py
│   ├── intent_parser.py        # 意图解析器
│   ├── file_indexer.py         # 智能索引生成器
│   ├── context_manager.py      # 上下文管理器
│   ├── constitution_engine.py  # 宪法规则引擎
│   └── task_dispatcher.py      # 任务分发器
│
├── services/                   # 服务层
│   ├── __init__.py
│   ├── file_service.py         # 文件操作服务
│   ├── search_service.py       # 搜索服务
│   ├── archive_service.py      # 打包服务
│   ├── monitor_service.py      # 文件监控服务
│   └── ai_suggestion.py        # AI建议服务（预留）
│
├── api/                        # API路由
│   ├── __init__.py
│   ├── commands.py             # 命令处理API
│   └── files.py                # 文件操作API
│
├── static/                     # 静态文件
│   ├── index.html              # 前端主页面
│   ├── css/
│   │   └── style.css           # 样式文件
│   └── js/
│       └── app.js              # 前端逻辑
│
├── config/                     # 配置目录
│   ├── __init__.py
│   ├── settings.py             # 配置管理器
│   └── constitution.yaml       # 宪法规则
│
├── utils/                      # 工具函数
│   ├── __init__.py
│   ├── path_utils.py           # 路径处理工具
│   ├── logger.py               # 日志配置
│   └── validation.py           # 输入验证
│
└── data/                       # 数据存储（运行时创建）
    ├── __init__.py
    ├── file_index.yaml         # 生成的索引文件
    └── context_cache.json      # 上下文缓存
```

## 🚀 启动和使用指南

### 第一步：安装和配置
```bash
# 1. 创建项目目录
mkdir omniframe_server
cd omniframe_server

# 2. 创建上述所有文件和目录结构
# （您已经获得了所有文件的代码）

# 3. 安装依赖
pip install -r requirements.txt

# 4. 复制环境配置
cp .env.example .env

# 5. 编辑 .env 文件，设置您的工作空间路径
# OMNIFRAME_ROOT_PATH=C:/Users/YourName/OmniFrame_Workspace


### 第二步：启动服务器
bash
# 方式1：直接运行
python server.py

# 方式2：使用CLI工具
python cli.py -i  # 交互模式

# 方式3：后台运行（Linux/macOS）
nohup python server.py > server.log 2>&1 &


### 第三步：开始使用
1. **Web界面**：访问 `http://localhost:8080`
2. **初始化索引**：在命令框输入"初始化索引"
3. **尝试命令**：
   - "列出所有文件"
   - "查找所有图片"
   - "打包最近的文档"
   - "显示系统状态"

### 第四步：扩展和定制
1. **修改宪法规则**：编辑 `config/constitution.yaml`
2. **添加新命令**：在 `core/intent_parser.py` 中添加模式
3. **定制界面**：修改 `static/` 目录下的文件
4. **集成其他服务**：在 `services/` 中添加新服务

## 🎯 核心工作流程

1. **用户输入**自然语言命令
2. **意图解析器**分析命令，提取意图和参数
3. **宪法引擎**检查操作是否符合安全规则
4. **任务分发器**调用相应的服务处理请求
5. **服务层**执行具体的文件操作
6. **结果返回**给用户，同时更新上下文

## 📈 性能优化建议

1. **索引优化**：对于大量文件，启用增量索引
2. **缓存策略**：常用查询结果可以缓存
3. **异步处理**：大文件操作使用异步模式
4. **内存管理**：定期清理上下文缓存
5. **监控告警**：设置资源使用告警阈值

## 🔧 故障排除

### 常见问题

1. **服务器无法启动**
   - 检查端口是否被占用
   - 检查Python版本是否为3.8+
   - 检查依赖是否安装完整

2. **文件操作失败**
   - 检查工作空间路径权限
   - 检查宪法规则是否阻止了操作
   - 查看服务器日志获取详细信息

3. **索引生成缓慢**
   - 减少监控的目录深度
   - 排除不必要的文件类型
   - 启用增量索引更新

### 日志位置
- 服务器日志：`logs/omniframe.log`
- 访问日志：控制台输出
- 错误追踪：详细错误信息在日志文件中

## 📚 学习资源

1. **FastAPI文档**：https://fastapi.tiangolo.com/
2. **Python异步编程**：https://docs.python.org/3/library/asyncio.html
3. **文件系统监控**：https://pythonhosted.org/watchdog/
4. **REST API设计**：https://restfulapi.net/

## 🎉 恭喜！

您现在已经拥有了一个完整的、功能强大的智能文件协同服务器。这个系统结合了我们之前讨论的所有先进理念：

- 🤖 **智能协同**：人类主导方向，AI实现逻辑
- 🛡️ **宪法约束**：所有操作都在安全边界内
- 📁 **智能索引**：自动理解和组织文件
- 🔄 **上下文感知**：记住您的偏好和工作模式
- 🌐 **多端访问**：Web界面、命令行、API

现在您可以开始使用这个系统来管理您的文件，体验"自然语言文件管理"的便利。随着使用，系统会越来越了解您的工作习惯，提供更精准的服务。

如果有任何问题或需要进一步的定制，请随时提问！